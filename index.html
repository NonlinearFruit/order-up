<!DOCTYPE html>
<html>
  <head>
    <title>Order Up</title>
    <link
      rel="stylesheet"
      media="(prefers-color-scheme:light)"
      href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.15.0/cdn/themes/light.css"
    />
    <link
      rel="stylesheet"
      media="(prefers-color-scheme:dark)"
      href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.15.0/cdn/themes/dark.css"
      onload="document.documentElement.classList.add('sl-theme-dark');"
    />
    <script type="module" src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.15.0/cdn/shoelace-autoloader.js"></script>
  </head>
  <body>
    <h1 class="title">Order Up</h1>

    <div class="description">
      <p>Order of people to do presentations within a time limit. Query parameters:</p>

      <p><code>participants</code>: comma-separated list</p>

      <p><code>secondsPerParticipant</code>: int</p>
    </div>

    <sl-card class="people card-header">
      <div slot="header">
        Participants
      </div>
      <ul id="peopleList">
      </ul>
      <sl-button id="shuffle" variant="primary" slot="footer" onclick="handleShuffle()">Shuffle</sl-button>
    </sl-card>

    <sl-card class="timer card-header">
      <div slot="header">
        Timer
      </div>

      <p id="timerDisplay">00:30</p>
      <sl-progress-bar id="timerProgress" value="0"></sl-progress-bar>

      <div slot="footer">
        <sl-button id="start" variant="primary" onclick="handleStart()">Start</sl-button>
        <sl-button id="cancel" variant="normal" onclick="handleCancel()" disabled>Cancel</sl-button>
      </div>
    </sl-card>

    <p class="footer">Made with <sl-animation name="heartBeat" duration="99999" play><sl-icon style="font-size: 10px; color: #e25555;" name="suit-heart-fill"></sl-icon></sl-animation> by NonlinearFruit (<a href="https://github.com/NonlinearFruit/order-up">source</a>)</p>

    <style>
      body {
        display: grid;
        grid-template-columns: 1fr auto auto 1fr;
        grid-column-gap: var(--sl-spacing-small);
        grid-template-rows: 1fr auto auto auto 2fr;
        justify-items: center;
      }
      .title {
        grid-column: 2 / 4;
        grid-row: 2 / 3;
      }
      .description {
        grid-column: 2 / 4;
        grid-row: 3 / 4;
        width:0;
        min-width:100%;
      }
      .people {
        grid-column: 2 / 3;
        grid-row: 4 / 5;
      }
      .timer {
        grid-column: 3 / 4;
        grid-row: 4 / 5;
      }
      .footer {
        grid-column: 2 / 4;
        grid-row: 5 / 5;
        color: var(--sl-color-neutral-300);
      }
    </style>
    <script>
      const urlParams = new URLSearchParams(window.location.search);
      const secondsPerParticipant = parseInt(urlParams.get("secondsPerParticipant") ?? "90");
      const people = (urlParams.get("participants") ?? "Your,Names,Here").split(",");
      const start = document.getElementById("start");
      const cancel = document.getElementById("cancel");
      const display = document.getElementById("timerDisplay");
      const progress = document.getElementById("timerProgress");
      const list = document.getElementById("peopleList");
      var intervalId = 0;
      reset();

      function reset() {
        displayTimeRemaining(secondsPerParticipant);
        setParticipantList(people);
      }

      function handleShuffle() {
        setParticipantList(people);
      }

      function handleStart() {
        start.toggleAttribute("disabled");
        cancel.toggleAttribute("disabled");
        startTimer(secondsPerParticipant);
      }

      function handleCancel() {
        start.toggleAttribute("disabled");
        cancel.toggleAttribute("disabled");
        clearInterval(intervalId);
        displayTimeRemaining(secondsPerParticipant);
      }

      function startTimer(durationInSeconds) {
        intervalId = setInterval(function () {
          displayTimeRemaining(--durationInSeconds)
        }, 1000);
      }

      function displayTimeRemaining(durationInSeconds) {
        const duration = Math.abs(durationInSeconds)
        var minutes = parseInt(duration / 60, 10);
        var seconds = parseInt(duration % 60, 10);

        sign = durationInSeconds < 0 ? "-" : "";
        minutes = minutes < 10 ? "0" + minutes : minutes;
        seconds = seconds < 10 ? "0" + seconds : seconds;

        display.textContent = sign + minutes + ":" + seconds;
        progress.setAttribute("value", durationInSeconds / secondsPerParticipant * 100);
      }

      function setParticipantList(participants) {
        list.innerHTML = "";
        participants
          .map(name => ({ name, sort: Math.random() }))
          .sort((a, b) => a.sort - b.sort)
          .map(({ name }) => name)
          .map(name => document.createTextNode(name))
          .forEach(text => list.appendChild(document.createElement('li')).appendChild(text));
      }
    </script>
  </body>
</html>

